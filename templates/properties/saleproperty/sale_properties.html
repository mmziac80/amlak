{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block title %}خرید ملک در مشهد - املاک هوشمند{% endblock %}

{% block content %}
<div class="container mt-5">
    <!-- AI Filter Section -->
    <div class="glass-card filter-section mb-4">
        <form method="get" class="ai-filter-form">
            <div class="row g-3">
                <div class="col-md-3">
                    {{ form.property_type|add_class:"form-control glass-input" }}
                </div>
                <div class="col-md-3">
                    {{ form.district|add_class:"form-control glass-input" }}
                </div>
                <div class="col-md-4">
                    <div class="price-range-slider">
                        <label class="glow-text">محدوده قیمت (تومان)</label>
                        <div id="price-slider"></div>
                        {{ form.min_sale_price }}
                        {{ form.max_sale_price }}
                    </div>
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-glow w-100">
                        <i class="fas fa-filter"></i> فیلتر هوشمند
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- Properties Grid -->
    <div class="row">
        {% for property in properties %}
        <div class="col-md-4 mb-4">
            <div class="glass-card property-card h-100">
                <div class="property-image">
                    {% if property.images %}
                    <img src="{{ property.images.url }}" alt="{{ property.title }}">
                    {% endif %}
                    <div class="property-badge glow-text">
                        <i class="fas fa-tag"></i> فروش
                    </div>
                </div>
                <div class="card-body">
                    <h5 class="card-title glow-text">{{ property.title }}</h5>
                    <p class="card-text">{{ property.description|truncatewords:20 }}</p>
                    <ul class="property-features">
                        <li><i class="fas fa-map-marker-alt glow-icon"></i> {{ property.get_district_display }}</li>
                        <li><i class="fas fa-ruler-combined glow-icon"></i> {{ property.area }} متر</li>
                        <li><i class="fas fa-layer-group glow-icon"></i> طبقه {{ property.floor }} از {{ property.total_floors }}</li>
                        <li><i class="fas fa-money-bill-wave glow-icon"></i> {{ property.price|intcomma }} تومان</li>
                        <li><i class="fas fa-calculator glow-icon"></i> هر متر: {{ property.price_per_meter|intcomma }} تومان</li>
                    </ul>
                </div>
                <div class="card-footer bg-transparent border-0">
                    <div class="d-flex justify-content-between">
                        <a href="{% url 'properties:sale_property_detail' property.id %}" class="btn btn-glow">جزئیات بیشتر</a>
                        <button class="btn btn-outline-glow favorite-btn" data-property-id="{{ property.id }}">
                            <i class="fas fa-heart"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12">
            <div class="glass-card text-center p-5">
                <i class="fas fa-search fa-3x mb-3 glow-icon"></i>
                <h3 class="glow-text">ملکی یافت نشد</h3>
                <p>با معیارهای جستجوی دیگری امتحان کنید</p>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if is_paginated %}
    <nav aria-label="Page navigation" class="mt-4">
        <ul class="pagination justify-content-center">
            {% if page_obj.has_previous %}
            <li class="page-item">
                <a class="page-link glass-pagination" href="?page={{ page_obj.previous_page_number }}">قبلی</a>
            </li>
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
            <li class="page-item {% if page_obj.number == num %}active{% endif %}">
                <a class="page-link glass-pagination" href="?page={{ num }}">{{ num }}</a>
            </li>
            {% endfor %}

            {% if page_obj.has_next %}
            <li class="page-item">
                <a class="page-link glass-pagination" href="?page={{ page_obj.next_page_number }}">بعدی</a>
            </li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}
</div>
{% endblock %}

{% block extra_css %}
<style>
    .property-image {
        position: relative;
        height: 200px;
        overflow: hidden;
    }

    .property-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }

    .property-card:hover .property-image img {
        transform: scale(1.1);
    }

    .property-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        padding: 5px 10px;
        background: rgba(26, 26, 26, 0.8);
        border-radius: 20px;
        backdrop-filter: blur(5px);
    }

    .glass-pagination {
        background: rgba(26, 26, 26, 0.8);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: var(--ai-light);
    }

    .glass-pagination:hover {
        background: var(--ai-primary);
        color: var(--ai-dark);
    }
</style>
{% endblock %}
