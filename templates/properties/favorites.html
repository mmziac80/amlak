
{% extends 'base.html' %}
{% load humanize %}

{% block title %}علاقه‌مندی‌های من - املاک مشهد{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2>علاقه‌مندی‌های من</h2>
    
    {% if favorites %}
        <div class="row">
            {% for property in favorites %}
                <div class="col-md-4 mb-4">
                    <div class="card h-100">
                        {% if property.images %}
                            <img src="{{ property.images.url }}" class="card-img-top" alt="{{ property.title }}">
                        {% endif %}
                        <div class="card-body">
                            <h5 class="card-title">{{ property.title }}</h5>
                            <p class="card-text">{{ property.description|truncatewords:20 }}</p>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-map-marker-alt"></i> {{ property.get_district_display }}</li>
                                <li><i class="fas fa-ruler-combined"></i> {{ property.area }} متر</li>
                                {% if property.daily_price %}
                                    <li><i class="fas fa-money-bill-wave"></i> {{ property.daily_price|intcomma }} تومان / شب</li>
                                {% elif property.price %}
                                    <li><i class="fas fa-money-bill-wave"></i> {{ property.price|intcomma }} تومان</li>
                                {% else %}
                                    <li><i class="fas fa-money-bill-wave"></i> ودیعه: {{ property.deposit|intcomma }} تومان</li>
                                    <li><i class="fas fa-money-bill-wave"></i> اجاره: {{ property.rent|intcomma }} تومان</li>
                                {% endif %}
                            </ul>
                            <div class="mt-3">
                                <button class="btn btn-danger btn-sm remove-favorite" data-property-id="{{ property.id }}">
                                    <i class="fas fa-heart-broken"></i> حذف از علاقه‌مندی‌ها
                                </button>
                                <a href="{{ property.get_absolute_url }}" class="btn btn-primary btn-sm">جزئیات بیشتر</a>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-info">
            شما هنوز ملکی را به علاقه‌مندی‌ها اضافه نکرده‌اید.
            <a href="{% url 'properties:home' %}">مشاهده املاک</a>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_scripts %}
<script>
$(document).ready(function() {
    $('.remove-favorite').click(function() {
        var propertyId = $(this).data('property-id');
        var button = $(this);
        
        $.ajax({
            url: '/api/properties/' + propertyId + '/favorite/',
            method: 'DELETE',
            success: function() {
                button.closest('.col-md-4').fadeOut();
            }
        });
    });
});
</script>
{% endblock %}
